<MudDialog>
    <TitleContent>Добавление перехода</TitleContent>
    <DialogContent>
        <MudField Label="Заготовка" Variant="Variant.Outlined">@WorkpieceInfo</MudField>
        <MudGrid Class="mt-2">
            <MudItem xs="4">
                <MudSelect Label="Тип" T="SequenceType" ValueChanged="OnSequenceChanged">
                    @foreach (var type in Enum.GetValues(typeof(SequenceType)))
                    {
                        switch (type)
                        {
                            case SequenceType.General:
                                <MudSelectItem Value="@SequenceType.General">Общие</MudSelectItem>
                                break;
                            case SequenceType.ExternalTurning:
                                <MudSelectItem Value="@SequenceType.ExternalTurning">Наружное точение</MudSelectItem>
                                break;
                            case SequenceType.Drilling:
                                <MudSelectItem Value="@SequenceType.Drilling">Сверление</MudSelectItem>
                                break;
                            case SequenceType.Threading:
                                <MudSelectItem Value="@SequenceType.Threading">Нарезание резьбы</MudSelectItem>
                                break;
                            case SequenceType.Grooving:
                                <MudSelectItem Value="@SequenceType.Grooving">Обработка канавок и отрезка</MudSelectItem>
                                break;
                        }
                    }
                </MudSelect>
            </MudItem>

            @switch (Type)
            {
                #region Общие
                case SequenceType.General:
                    <MudItem xs="4">
                        <MudSelect Label="Переход" T="GeneralSequences" @bind-Value="GeneralSequence">
                            <MudSelectItem Value="@(GeneralSequences.Limiter)">Упор</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="4">
                        <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                            @foreach (var tool in Tools)
                            {
                                <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    break;
                #endregion
                #region Токарные
                case SequenceType.ExternalTurning:
                    <MudItem xs="4">
                        <MudSelect Label="Переход" T="TurningSequences" @bind-Value="TurningSequence">
                            <MudSelectItem Value="@(TurningSequences.Facing)">Торцевание</MudSelectItem>
                            <MudSelectItem Value="@(TurningSequences.RoughFacing)">Черновое торцевание</MudSelectItem>
                            <MudSelectItem Value="@(TurningSequences.FinishFacing)">Чистовое торцевание</MudSelectItem>
                            <MudSelectItem Value="@(TurningSequences.RoughTurning)">Черновое точение</MudSelectItem>
                            <MudSelectItem Value="@(TurningSequences.FinishTurning)">Чистовое точение</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="4">
                        <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                            @foreach (var tool in Tools.Where(x => x is TurningExternalTool))
                            {
                                <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    @if (TurningSequence == TurningSequences.Facing)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Общий припуск" @bind-Value="_RoughStockAllow" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Съем" @bind-Value="_StepOver" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Чистовой припуск по Z" @bind-Value="_ProfStockAllowZ" Immediate="true" />
                        </MudItem>
                    }
                    @if (TurningSequence == TurningSequences.RoughFacing)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Общий припуск" @bind-Value="_RoughStockAllow" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Съем" @bind-Value="_StepOver" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Чистовой припуск по Z" @bind-Value="_ProfStockAllowZ" Immediate="true" />
                        </MudItem>
                    }
                    @if (TurningSequence == TurningSequences.FinishFacing)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Чистовой припуск по Z" @bind-Value="_ProfStockAllowZ" Immediate="true" />
                        </MudItem>
                    }
                    @if (TurningSequence == TurningSequences.RoughTurning)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Съем" @bind-Value="_StepOver" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Чистовой припуск по Х" @bind-Value="_ProfStockAllowX" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Чистовой припуск по Z" @bind-Value="_ProfStockAllowZ" Immediate="true" />
                        </MudItem>
                    }
                    break;
                #endregion
                #region Сверлильные
                case SequenceType.Drilling:
                    <MudItem xs="4">
                        <MudSelect Label="Переход" T="DrillingSequences" @bind-Value="DrillingSequence">
                            <MudSelectItem Value="@(DrillingSequences.HighSpeedDrilling)">Высокоскоростное сверление</MudSelectItem>
                            <MudSelectItem Value="@(DrillingSequences.PeckingDrilling)">Прерывистое сверление</MudSelectItem>
                            <MudSelectItem Value="@(DrillingSequences.PeckingDeepDrilling)">Глубокое сверление</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="4">
                        <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                            @foreach (var tool in Tools.Where(x => x is DrillingTool))
                            {
                                <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    @if (DrillingSequence == DrillingSequences.HighSpeedDrilling)
                    {
                        <MudItem xs="6">
                            <MudTextField Label="Начальная точка" @bind-Value="_DrillStart" Immediate="true" />
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Конечная точка" @bind-Value="_DrillEnd" Immediate="true" />
                        </MudItem>
                    }
                    @if (DrillingSequence == DrillingSequences.PeckingDrilling)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Глубина" @bind-Value="_PeckingDepth" Adornment="Adornment.End" AdornmentText="мм" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Начальная точка" @bind-Value="_DrillStart" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Конечная точка" @bind-Value="_DrillEnd" Immediate="true" />
                        </MudItem>
                    }
                    @if (DrillingSequence == DrillingSequences.PeckingDeepDrilling)
                    {
                        <MudItem xs="4">
                            <MudTextField Label="Глубина" @bind-Value="_PeckingDeepDepth" Adornment="Adornment.End" AdornmentText="мм" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Начальная точка" @bind-Value="_DrillStart" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Конечная точка" @bind-Value="_DrillEnd" Immediate="true" />
                        </MudItem>
                    }
                    break;
                #endregion
                #region Резьбонарезные
                case SequenceType.Threading:
                    <MudItem xs="4">
                        <MudSelect Label="Переход" T="ThreadingSequences" ValueChanged="OnThreadingSequenceChanged">
                            <MudSelectItem Value="@(ThreadingSequences.ThreadCutting)">Точение резьбы</MudSelectItem>
                            <MudSelectItem Value="@(ThreadingSequences.Tapping)">Нарезание метчиком</MudSelectItem>
                        </MudSelect>
                    </MudItem>

                    @if (ThreadingSequence == ThreadingSequences.ThreadCutting)
                    {
                        <MudItem xs="4">
                            <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                                @foreach (var tool in Tools.Where(x => x is ThreadingExternalTool))
                                {
                                    <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="6">
                            <MudSelect Label="Стандарт" T="ThreadStandart" @bind-Value="ThreadStandart">
                                <MudSelectItem Value="@(ThreadStandart.Metric)">60° Метрическая</MudSelectItem>
                                <MudSelectItem Value="@(ThreadStandart.BSPP)">55° Трубная цилиндрическая</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="6">
                            <MudSelect Label="Тип" T="CuttingType" @bind-Value="ThreadType">
                                <MudSelectItem Value="@(CuttingType.External)">Наружная</MudSelectItem>
                                <MudSelectItem Value="@(CuttingType.Internal)">Внутренняя</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Диаметр резьбы" @bind-Value="_ThreadDiameter" Immediate="true" />
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Шаг резьбы" @bind-Value="_ThreadPitch" Immediate="true" />
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Начальная точка" @bind-Value="_ThreadStart" Immediate="true" />
                        </MudItem>
                        <MudItem xs="6">
                            <MudTextField Label="Конечная точка" @bind-Value="_ThreadEnd" Immediate="true" />
                        </MudItem>
                    }
                    @if (ThreadingSequence == ThreadingSequences.Tapping)
                    {
                        <MudItem xs="4">
                            <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                                @foreach (var tool in Tools.Where(x => x is TappingTool))
                                {
                                    <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Скорость резания" @bind-Value="_TapCutSpeed" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Начальная точка" @bind-Value="_TapStart" Immediate="true" />
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField Label="Конечная точка" @bind-Value="_TapEnd" Immediate="true" />
                        </MudItem>
                    }
                    break;
                #endregion
                #region Канавочные
                case SequenceType.Grooving:
                    <MudItem xs="4">
                        <MudSelect Label="Переход" T="GroovingSequences" @bind-Value="GroovingSequence">
                            <MudSelectItem Value="@(GroovingSequences.Grooving)">Канавка</MudSelectItem>
                            <MudSelectItem Value="@(GroovingSequences.Cutting)">Отрезка</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="4">
                        <MudSelect @bind-Value="Tool" Label="Инструмент" T="Tool">
                            @foreach (var tool in Tools.Where(x => x is GroovingExternalTool))
                            {
                                <MudSelectItem Value="@tool">@tool.Description()</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    break;
                #endregion
                default:
                    break;
            }
        </MudGrid>
        <MudItem Class="mt-4" xs="12" sm="12" md="12">
            <MudTextField T="string" DisableUnderLine="true" Label="Предпросмотр" Class="monofield" Variant="Variant.Filled" Text="@ProgramText.Trim('\n')" Lines="@(ProgramText.Trim('\n').Count(x => x == '\n') + 1)" />
        </MudItem>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Primary" Variant="Variant.Outlined" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>


@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    public SequenceType Type { get; set; }


    void Submit() => MudDialog.Close(DialogResult.Ok(true));
    void Cancel() => MudDialog.Cancel();
}